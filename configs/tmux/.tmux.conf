# =============================================================================
# Tmux Configuration
# Author: Ikaros
# =============================================================================

# =============================================================================
# General Settings
# =============================================================================

# Set prefix to Ctrl+a (more accessible than Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Don't rename windows automatically
set -g allow-rename off

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status-left and status-right more often
set -g status-interval 5

# Enable focus events (useful for vim)
set -g focus-events on

# Set default terminal
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Faster command sequences
set -sg escape-time 0

# Increase repeat time for repeatable commands
set -g repeat-time 1000

# Set parent terminal title to reflect current window in tmux session
set -g set-titles on
set -g set-titles-string "#I:#W"

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Aggressive resize (for grouped sessions and multi-monitor)
setw -g aggressive-resize on

# =============================================================================
# Key Bindings
# =============================================================================

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Use Alt+vim keys to switch panes without prefix
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Use Alt+arrow keys to switch panes without prefix
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with vim keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -n C-S-Left previous-window
bind -n C-S-Right next-window
bind -n S-Left previous-window
bind -n S-Right next-window

# Create new window in current directory
bind c new-window -c "#{pane_current_path}"

# Move windows
bind -r < swap-window -t -1\; select-window -t -1
bind -r > swap-window -t +1\; select-window -t +1

# Quick window selection
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Session navigation
bind ( switch-client -p
bind ) switch-client -n

# Kill pane/window/session shortcuts
bind x kill-pane
bind X kill-window
bind Q confirm-before -p "Kill session #S? (y/n)" kill-session

# Synchronize panes (send command to all panes)
bind S setw synchronize-panes

# Clear screen and history
bind C-l send-keys 'C-l'
bind -n C-k clear-history

# =============================================================================
# Copy Mode (Vi-style)
# =============================================================================

# Use vi mode
setw -g mode-keys vi

# Enter copy mode with prefix + [
bind [ copy-mode

# Setup 'v' to begin selection like vim
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Setup 'y' to copy selection (wayland clipboard)
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send -X copy-pipe-and-cancel "wl-copy"

# Mouse copy (wayland clipboard)
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "wl-copy"

# Paste with prefix + p
bind p paste-buffer
bind P choose-buffer

# Search
bind / copy-mode \; send-key ?

# =============================================================================
# Appearance (Tokyo Night Theme)
# =============================================================================

# Status bar colors
set -g status-style "bg=#1a1b26,fg=#c0caf5"

# Status bar position
set -g status-position bottom
set -g status-justify left

# Status bar length
set -g status-left-length 100
set -g status-right-length 100

# Pane border colors
set -g pane-border-style "fg=#414868"
set -g pane-active-border-style "fg=#7aa2f7"

# Message style
set -g message-style "bg=#7aa2f7,fg=#1a1b26"
set -g message-command-style "bg=#414868,fg=#c0caf5"

# Mode style (for copy mode highlight)
set -g mode-style "bg=#33467c,fg=#c0caf5"

# Clock mode
set -g clock-mode-colour "#7aa2f7"
set -g clock-mode-style 24

# Status bar left
set -g status-left "#[bg=#7aa2f7,fg=#1a1b26,bold] #S #[bg=#1a1b26,fg=#7aa2f7]"

# Status bar right
set -g status-right "#[fg=#414868]#[bg=#414868,fg=#c0caf5] %H:%M #[fg=#7aa2f7]#[bg=#7aa2f7,fg=#1a1b26,bold] %Y-%m-%d "

# Window status
set -g window-status-format "#[fg=#565f89] #I:#W "
set -g window-status-current-format "#[fg=#1a1b26,bg=#7aa2f7] #I:#W #[fg=#7aa2f7,bg=#1a1b26]"

# Window status separator
set -g window-status-separator ""

# Window activity indicator
setw -g window-status-activity-style "fg=#e0af68,bg=#1a1b26"

# =============================================================================
# Plugins (TPM - Tmux Plugin Manager)
# =============================================================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Plugin settings
# Resurrect - save and restore tmux sessions
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Continuum - automatic session saving
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Yank - copy to system clipboard
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# =============================================================================
# Initialize TPM (keep this at the very bottom of tmux.conf)
# =============================================================================

# Auto-install TPM if not present
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

run '~/.tmux/plugins/tpm/tpm'
